/**
 * UI-Router Extras: Sticky states, Future States, Deep State Redirect, Transition promise
 * Monolithic build (all modules)
 * @version 0.0.13
 * @link http://christopherthielen.github.io/ui-router-extras/
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
(function(n,t){"use strict";function k(n,t){var r=[];for(var i in n.path){if(n.path[i]!==t.path[i])break;r.push(n.path[i])}return r}function d(t){if(Object.keys)return Object.keys(t);var i=[];return n.forEach(t,function(n,t){i.push(t)}),i}function et(n,t){var i=[];for(var r in n)t&&t.indexOf(r)!==-1||i.push(r);return i}function g(n,t){if(Array.prototype.indexOf)return n.indexOf(t,Number(arguments[2])||0);var r=n.length>>>0,i=Number(arguments[2])||0;for(i=i<0?Math.ceil(i):Math.floor(i),i<0&&(i+=r);i<r;i++)if(i in n&&n[i]===t)return i;return-1}function ot(n,t,i,r){var f=k(i,r),u,h={},c=[],e,o;for(e in f)if(f[e].params&&(u=w(f[e].params)?f[e].params:d(f[e].params),u.length))for(o in u)g(c,u[o])>=0||(c.push(u[o]),h[u[o]]=n[u[o]]);return s({},h,t)}function nt(n,t){return s(new(s(function(){},{prototype:n})),t)}function st(n){p.push(n)}function tt(){a=t}function rt(t,i){var f=i,o=f.inheritParams,s=f.protoKeys,h=f.map,u={},c={},e=!1;this.registerStickyState=function(n){c[n.name]=n};this.enableDebug=this.debugMode=function(t){return n.isDefined(t)&&(e=t),e};this.$get=["$rootScope","$state","$stateParams","$injector","$log",function(t,i,f,c,l){function y(){var t={};return n.forEach(u,function(n){for(var i,u=w(n),r=0;r<u.length;r++)i=u[r].parent,t[i.name]=t[i.name]||[],t[i.name].push(n);t[""]&&(t.__inactives=t[""])}),t}function w(n){var t=[];if(!n)return t;do n.sticky&&t.push(n),n=n.parent;while(n);return t.reverse(),t}function b(n,t,i){if(n[i]===t[i])return{from:!1,to:!1};var r=i<n.length&&n[i].self.sticky,u=i<t.length&&t[i].self.sticky;return{from:r,to:u}}function k(n,t,i,r){var f,e;return r?"updateStateParams":(f=u[n.self.name],!f)?"enter":n.self===i?"updateStateParams":(e=v(t,f.locals.globals.$stateParams,n.ownParams),e?"reactivate":"updateStateParams")}function a(n,t){var i=u[n.name],r;return i?t?(r=v(t,i.locals.globals.$stateParams,n.ownParams),r?i:null):i:null}function v(t,i,r){var e,u,f;if(!n.isArray(r)&&n.isObject(r)&&(r=s(r,["$$keys","$$values","$$equals","$$validates","$$new","$$parent"])),!r){r=[];for(e in t)r.push(e)}for(u=0;u<r.length;u++)if(f=r[u],t[f]!=i[f])return!1;return!0}var p={getInactiveStates:function(){var t=[];return n.forEach(u,function(n){t.push(n)}),t},getInactiveStatesByParent:function(){return y()},processTransition:function(t){var s={inactives:[],enter:[],exit:[],keep:0},a=t.fromState.path,et=t.fromParams,u=t.toState.path,w=t.toParams,ot=t.reloadStateTree,it=t.options,e=0,d=u[e],p,ut,ft,tt;for(it.inherit&&(w=o(f,w||{},i.$current,t.toState));d&&d===a[e]&&v(w,et,d.ownParams);)d=u[++e];s.keep=e;for(var c,l,g={},rt=b(a,u,e),nt=!!it.reload,r=e;r<u.length;r++)p=rt.to?k(u[r],w,ot,nt):"enter",nt=nt||p=="updateStateParams",s.enter[r]=p,p=="reactivate"&&(l=g[u[r].name]=u[r]),p=="updateStateParams"&&(c=g[u[r].name]=u[r]);for(l=l?l.self.name+".":"",c=c?c.self.name+".":"",ut=y(),ft=[""].concat(h(a.slice(0,e),function(n){return n.self.name})),n.forEach(ft,function(n){for(var t,i=ut[n],r=0;i&&r<i.length;r++)t=i[r],g[t.name]||l&&t.self.name.indexOf(l)===0||c&&t.self.name.indexOf(c)===0||s.inactives.push(t)}),r=e;r<a.length;r++)tt="exit",rt.from&&(s.inactives.push(a[r]),tt="inactivate"),s.exit[r]=tt;return s},stateInactivated:function(n){u[n.self.name]=n;n.self.status="inactive";n.self.onInactivate&&c.invoke(n.self.onInactivate,n.self,n.locals.globals)},stateReactivated:function(n){u[n.self.name]&&delete u[n.self.name];n.self.status="entered";n.self.onReactivate&&c.invoke(n.self.onReactivate,n.self,n.locals.globals)},stateExiting:function(t,i,f){var o={};n.forEach(i,function(n){o[n.self.name]=!0});n.forEach(u,function(i,f){!o[f]&&i.includes[t.name]&&(e&&l.debug("Exiting "+f+" because it's a substate of "+t.name+" and wasn't found in ",o),i.self.onExit&&c.invoke(i.self.onExit,i.self,i.locals.globals),n.forEach(i.locals,function(n,t){delete r.locals[t]}),i.locals=null,i.self.status="exited",delete u[f])});f&&c.invoke(f,t.self,t.locals.globals);t.locals=null;t.self.status="exited";delete u[t.self.name]},stateEntering:function(n,t,i,r){var u=a(n),f;u&&(r||!a(n,t))&&(f=n.locals,this.stateExiting(u),n.locals=f);n.self.status="entered";i&&c.invoke(i,n.self,n.locals.globals)},reset:function(n,r){var f=i.get(n),u=a(f,r);return u?(p.stateExiting(u),t.$broadcast("$viewContentLoading"),!0):!1}};return p}]}function c(n){return{resolve:{},locals:{globals:f&&f.locals&&f.locals.globals},views:{},self:{},params:{},ownParams:v.hasParamSet?{$$equals:function(){return!0}}:[],surrogateType:n}}function ht(t,r,f){function e(n,t,i){return n[t]?n[t].toUpperCase()+": "+i.self.name:"("+i.self.name+")"}var o=i(f.inactives,function(n){return n.self.name}),s=i(r.toState.path,function(n,t){return e(f.enter,t,n)}),h=i(r.fromState.path,function(n,t){return e(f.exit,t,n)}),c=r.fromState.self.name+": "+n.toJson(r.fromParams)+":  -> "+r.toState.self.name+": "+n.toJson(r.toParams);t.debug("   Current transition: ",c);t.debug("Before transition, inactives are:   : ",i(u.getInactiveStates(),function(n){return n.self.name}));t.debug("After transition,  inactives will be: ",o);t.debug("Transition will exit:  ",h);t.debug("Transition will enter: ",s)}function ct(n,t,r){n.debug("Current state: "+t.self.name+", inactive states: ",i(u.getInactiveStates(),function(n){return n.self.name}));for(var s=function(n,t){return"'"+t+"' ("+n.$$state.name+")"},h=function(n,t){return t!="globals"&&t!="resolve"},o=function(n){var t=i(b(n.locals,h),s).join(", ");return"("+(n.self.name?n.self.name:"root")+".locals"+(t.length?": "+t:"")+")"},e=o(t),f=t.parent;f&&f!==t;)f.self.name===""&&(e=o(r.$current.path[0])+" / "+e),e=o(f)+" / "+e,t=f,f=t.parent;n.debug("Views: "+e)}var y=n.module("ct.ui.router.extras.core",["ui.router"]),l={},p=[],a,it;y.config(["$stateProvider","$injector",function(t){t.decorator("parent",function(t,i){return l[t.self.name]=t,t.self.$$state=function(){return l[t.self.name]},n.forEach(p,function(n){n(t)}),i(t)})}]);var o=n.forEach,s=n.extend,w=n.isArray,i=function(n,t){var i=[];return o(n,function(n,r){i.push(t(n,r))}),i},ut=function(n){return i(n,function(n,t){return t})},ft=function(n,t){var i=[];return o(n,function(n,r){t(n,r)&&i.push(n)}),i},b=function(n,t){var i={};return o(n,function(n,r){t(n,r)&&(i[r]=n)}),i};y.provider("uirextras_core",function(){var t={internalStates:l,onStateRegistered:st,forEach:o,extend:s,isArray:w,map:i,keys:ut,filter:ft,filterObj:b,ancestors:k,objectKeys:d,protoKeys:et,arraySearch:g,inheritParams:ot,inherit:nt};n.extend(this,t);this.$get=function(){return t}});n.module("ct.ui.router.extras.dsr",["ct.ui.router.extras.core"]).config(["$provide",function(n){var t;n.decorator("$state",["$delegate","$q",function(n,i){return t=n.transitionTo,n.transitionTo=function(r,u,f){return f.ignoreDsr&&(a=f.ignoreDsr),t.apply(n,arguments).then(function(n){return tt(),n},function(n){return tt(),i.reject(n)})},n}])}]);n.module("ct.ui.router.extras.dsr").service("$deepStateRedirect",["$rootScope","$state","$injector",function(i,r,u){function c(n){var t=n.name;if(e.hasOwnProperty(t))return e[t];l(t)}function o(t){var r=t.deepStateRedirect||t.dsr,i;return r?(i={dsr:!0},n.isFunction(r)?i.fn=r:n.isObject(r)&&(i=n.extend(i,r)),n.isString(i.default)&&(i.default={state:i.default}),i.fn||(i.fn=["$dsr$",function(n){return n.redirect.state!=n.to.state}]),i):{dsr:!1}}function l(n){var i=r.get(n),s,u,c;return i?(s=o(i),s.dsr&&(e[i.name]=h,f[n]===t&&(f[n]={})),u=i.$$state&&i.$$state().parent,u&&(c=l(u.self.name),c&&e[i.name]===t&&(e[i.name]=y)),e[i.name]||!1):!1}function v(i,r){r===!0&&(r=Object.keys(i));(r===null||r===t)&&(r=[]);var u={};return n.forEach(r.sort(),function(n){u[n]=i[n]}),u}function s(t,i){function f(n){return n?n.toString():n}var u=v(t,i),r={};return n.forEach(u,function(n,t){r[t]=f(n)}),n.toJson(r)}var f={},e={},h="Redirect",y="AncestorRedirect";return i.$on("$stateChangeStart",function(t,i,e){var y=o(i),w,l,b,p,k;!a&&(c(i)===h||y.default)&&(w=s(e,y.params),l=f[i.name][w]||y.default,l)&&(b={redirect:{state:l.state,params:l.params},to:{state:i.name,params:e}},p=u.invoke(y.fn,i,{$dsr$:b}),p)&&(p.state&&(l=p),t.preventDefault(),k=v(e,y.params),r.go(l.state,n.extend(k,l.params)))}),i.$on("$stateChangeSuccess",function(t,i,u){var h=c(i),e;h&&(e=i.name,n.forEach(f,function(t,i){var h=o(r.get(i)),c=s(u,h.params);(e==i||e.indexOf(i+".")!=-1)&&(f[i][c]={state:e,params:n.copy(u)})}))}),{reset:function(t,i){var u,e;if(t){if(u=r.get(t),!u)throw new Error("Unknown state: "+t);f[u.name]&&(i?(e=s(i,o(u).params),delete f[u.name][e]):f[u.name]={})}else n.forEach(f,function(n,t){f[t]={}})}}}]);n.module("ct.ui.router.extras.dsr").run(["$deepStateRedirect",function(){}]);n.module("ct.ui.router.extras.sticky",["ct.ui.router.extras.core"]);it=n.module("ct.ui.router.extras.sticky");rt.$inject=["$stateProvider","uirextras_coreProvider"];it.provider("$stickyState",rt);var u,l={},f,h=[],e,r,v={hasParamSet:!1};n.module("ct.ui.router.extras.sticky").run(["$stickyState",function(n){u=n}]);n.module("ct.ui.router.extras.sticky").config(["$provide","$stateProvider","$stickyStateProvider","$urlMatcherFactoryProvider","uirextras_coreProvider",function(o,s,l,a,y){var p=y.internalStates,w;v.hasParamSet=!!a.ParamSet;r=n.extend(new c("__inactives"),{self:{name:"__inactives"}});f=e=t;h=[];y.onStateRegistered(function(n){n.self.sticky===!0&&l.registerStickyState(n.self)});o.decorator("$state",["$delegate","$log","$q",function(o,s,y){return f=o.$current,p[""]=f,f.parent=r,r.parent=t,f.locals=nt(r.locals,f.locals),delete r.locals.globals,w=o.transitionTo,o.transitionTo=function(t,b,k){function si(t){var i=n.extend(new c("reactivate_phase1"),{locals:t.locals});return i.self=n.extend({},t.self),i}function hi(t){var i=n.extend(new c("reactivate_phase2"),t),r=i.self.onEnter;return i.resolve={},i.views={},i.self.onEnter=function(){i.locals=t.locals;u.stateReactivated(t)},d.addRestoreFunction(function(){t.self.onEnter=r}),i}function ci(n){var t=new c("inactivate"),i;return t.self=n.self,i=n.self.onExit,t.self.onExit=function(){u.stateInactivated(n)},d.addRestoreFunction(function(){n.self.onExit=i}),t}function li(n,t){var i=n.self.onEnter;return n.self.onEnter=function(){u.stateEntering(n,t,i)},d.addRestoreFunction(function(){n.self.onEnter=i}),n}function ai(n,t){var i=n.self.onEnter;return n.self.onEnter=function(){u.stateEntering(n,t,i,!0)},d.addRestoreFunction(function(){n.self.onEnter=i}),n}function ui(n){var t=n.self.onExit;return n.self.onExit=function(){u.stateExiting(n,lt,t)},d.addRestoreFunction(function(){n.self.onExit=t}),n}var rt=l.debugMode(),ni,ri,d,g,ft,at,vt,et,ot,fi,it,tt,bt,dt,gt,ei;r.locals||(r.locals=f.locals);ni=h.length;e&&(e(),rt&&s.debug("Restored paths from pending transition"));var ut=o.$current,oi=o.params,ti=k&&k.relative||o.$current,ii=o.get(t,ti),st,pt,nt,kt=[],lt=[],wt;if(b=b||{},arguments[1]=b,ri=function(){},d=function(){st&&(g.path=st,st=null);pt&&(ut.path=pt,pt=null);n.forEach(d.restoreFunctions,function(n){n()});d=ri;e=null;h.splice(ni,1)},d.restoreFunctions=[],d.addRestoreFunction=function(n){this.restoreFunctions.push(n)},ii&&(g=p[ii.name],g)){for(st=g.path,pt=ut.path,ft=k&&k.reload||!1,at=ft&&(ft===!0?st[0].self:o.get(ft,ti)),k&&ft&&ft!==!0&&delete k.reload,vt={toState:g,toParams:b||{},fromState:ut,fromParams:oi||{},options:k,reloadStateTree:at},h.push(vt),e=d,at&&(vt.toParams.$$uirouterextrasreload=Math.random(),et=at.$$state().params,ot=at.$$state().ownParams,v.hasParamSet?(fi=new a.Param("$$uirouterextrasreload"),et.$$uirouterextrasreload=ot.$$uirouterextrasreload=fi,d.restoreFunctions.push(function(){delete et.$$uirouterextrasreload;delete ot.$$uirouterextrasreload})):(et.push("$$uirouterextrasreload"),ot.push("$$uirouterextrasreload"),d.restoreFunctions.push(function(){et.length=et.length-1;ot.length=ot.length-1}))),nt=u.processTransition(vt),rt&&ht(s,vt,nt),it=g.path.slice(0,nt.keep),tt=ut.path.slice(0,nt.keep),n.forEach(r.locals,function(n,t){t.indexOf("@")!=-1&&delete r.locals[t]}),bt=0;bt<nt.inactives.length;bt++)dt=nt.inactives[bt].locals,n.forEach(dt,function(n,t){dt.hasOwnProperty(t)&&t.indexOf("@")!=-1&&(r.locals[t]=n)});if(n.forEach(nt.enter,function(n,t){var r,i=g.path[t];n==="reactivate"?(r=si(i),it.push(r),tt.push(r),kt.push(hi(i)),wt=i):n==="updateStateParams"?(r=ai(i),it.push(r),wt=i):n==="enter"&&it.push(li(i))}),n.forEach(nt.exit,function(n,t){var i=ut.path[t];n==="inactivate"?(tt.push(ci(i)),lt.push(i)):n==="exit"&&(tt.push(ui(i)),lt.push(i))}),kt.length&&n.forEach(kt,function(n){it.push(n)}),g===wt){var vi=wt.self.name+".",yi=u.getInactiveStates(),yt=[];yi.forEach(function(n){n.self.name.indexOf(vi)===0&&yt.push(n)});yt.sort();yt.reverse();tt=tt.concat(i(yt,function(n){return ui(n)}));lt=lt.concat(yt)}g.path=it;ut.path=tt;gt=function(n){return(n.surrogateType?n.surrogateType+":":"")+n.self.name};rt&&s.debug("SurrogateFromPath: ",i(tt,gt));rt&&s.debug("SurrogateToPath:   ",i(it,gt))}return ei=w.apply(o,arguments),ei.then(function(n){return d(),rt&&ct(s,p[n.name],o),n.status="active",n},function(n){return d(),rt&&n.message!=="transition prevented"&&n.message!=="transition aborted"&&n.message!=="transition superseded"&&(s.debug("transition failed",n),console.log(n.stack)),y.reject(n)})},o}])}]),function(n,t){function u(t,i,r,u){function p(t,i){var r=n.isObject(t)?t.name:t;return i?f[r]:k[r]}function w(n,t){var r,e,i,s,h,c,u,o;if(t.name)for(r=t.name.split(/\./),t.name.charAt(0)==="."&&(r[0]=n.current.name);r.length;){if(e=r.join("."),n.get(e,{relative:n.current}))return null;if(f[e])return f[e];r.pop()}if(t.url){i=[];for(s in f)h=f[s].urlMatcher,h&&h.exec(t.url)&&i.push(f[s]);for(c=i.slice(0),u=i.length-1;u>=0;u--)for(o=0;o<c.length;o++)i[u]===c[o].parentFutureState&&i.splice(u,1);return i[0]}}function c(n,t){var u,o,s,i,h,r;if(e=!0,u=n.get("$q"),!t)return o=u.defer(),o.reject("No lazyState passed in "+t),o.promise;if(s=u.when([]),i=t.parentFutureState,i&&f[i.name]&&(s=c(n,f[i.name])),h=t.type,r=l[h],!r)throw Error("No state factory for futureState.type: "+(t&&t.type));return s.then(function(i){var u=n.invoke(r,r,{futureState:t});return u.then(function(n){return n&&i.push(n),i})})["finally"](function(){delete f[t.name]})}function d(n,i){var r=!1,f=["$rootScope","$urlRouter","$state",function(u,f,s){function l(){r=!0;f.sync();r=!1}if(!v){o().then(l);v=!0;return}var a=w(s,{url:i.path()});if(!a)return n.invoke(h);c(n,a).then(function(n){n.forEach(function(n){n&&(!s.get(n)||n.name&&!s.get(n.name))&&t.state(n)});e=!1;l()},function(){e=!1;l()})}],u;if(!e)return u=r?h:f,n.invoke(u)}var b=u,k=b.internalStates,l={},f={},e=!1,a=[],o,v=!1,y=this,h,s;this.addResolve=function(n){a.push(n)};this.stateFactory=function(n,t){l[n]=t};this.futureState=function(t){var i,u,e,o,s;if(t.stateName&&(t.name=t.stateName),t.urlPrefix&&(t.url="^"+t.urlPrefix),f[t.name]=t,u=t.name.split(/\./).slice(0,-1).join("."),e=p(t.parent||u),e)i=e.url||e.navigable.url;else if(u==="")i=r.compile("");else{if(o=p(t.parent||u,!0),!o)throw new Error("Couldn't determine parent state of future state. FutureState:"+n.toJson(t));s=o.urlMatcher.source.replace(/\*rest$/,"");i=r.compile(s);t.parentFutureState=o}t.url&&(t.urlMatcher=t.url.charAt(0)==="^"?r.compile(t.url.substring(1)+"*rest"):i.concat(t.url+"*rest"))};this.get=function(){return n.extend({},f)};h=["$log","$location",function(n,t){n.debug("Unable to map "+t.path())}];i.otherwise(d);i.otherwise=function(t){if(n.isString(t)){var r=t;t=function(){return r}}else if(!n.isFunction(t))throw new Error("'rule' must be a function");return h=["$injector","$location",t],i};s={getResolvePromise:function(){return o()}};this.$get=["$injector","$state","$q","$rootScope","$urlRouter","$timeout","$log",function(i,r,u,f,h,l,v){function p(){if(f.$on("$stateNotFound",function(n,u,f,o){var s,h;e||(v.debug("event, unfoundState, fromState, fromParams",n,u,f,o),s=w(r,{name:u.to}),s)&&(n.preventDefault(),h=c(i,s),h.then(function(n){n.forEach(function(n){n&&(!r.get(n)||n.name&&!r.get(n.name))&&t.state(n)});r.go(u.to,u.toParams);e=!1},function(n){console.log("failed to lazy load state ",n);r.go(f,o);e=!1}))}),!o){var s=[];n.forEach(a,function(n){s.push(i.invoke(n))});o=function(){return u.all(s)}}o().then(function(){l(function(){r.transition?r.transition.then(h.sync,h.sync):h.sync()})})}return p(),s.state=t.state,s.futureState=y.futureState,s.get=y.get,s}]}var r=n.module("ct.ui.router.extras.future",["ct.ui.router.extras.core"]),i;u.$inject=["$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","uirextras_coreProvider"];r.provider("$futureState",u);i={state:function(n){i.$rootScope&&i.$rootScope.$broadcast("$stateAdded",n)},itsNowRuntimeOhWhatAHappyDay:function(n){i.$rootScope=n},$rootScope:t};r.config(["$stateProvider",function(t){var r=t.state;t.state=function(){var u=r.apply(t,arguments),f=n.isObject(arguments[0])?arguments[0]:arguments[1];return i.state(f),u}}]);r.run(["$futureState",function(n,t){i.itsNowRuntimeOhWhatAHappyDay(t)}])}(n);n.module("ct.ui.router.extras.previous",["ct.ui.router.extras.core","ct.ui.router.extras.transition"]).service("$previousState",["$rootScope","$state",function(n,i){var r=null,u=null,f={},e;return n.$on("$transitionStart",function(n,t){function e(){u=null}function o(){r=u}var i=t.from,f=i.state&&i.state.$$state&&i.state.$$state();f&&f.navigable&&(u=r,r=t.from);t.promise.then(e).catch(o)}),e={get:function(n){return n?f[n]:r},go:function(n,t){var r=e.get(n);return i.go(r.state,r.params,t)},memo:function(n,t,u){f[n]=r||{state:i.get(t),params:u}},forget:function(n){n?delete f[n]:r=t}}}]);n.module("ct.ui.router.extras.previous").run(["$previousState",function(){}]);n.module("ct.ui.router.extras.transition",["ct.ui.router.extras.core"]).config(["$provide",function(t){t.decorator("$state",["$delegate","$rootScope","$q","$injector",function(t,i,r,u){function c(t){var i=u.invoke,r=u.instantiate;return u.invoke=function(r,u,f){return i(r,u,n.extend({$transition$:t},f))},u.instantiate=function(i,u){return r(i,n.extend({$transition$:t},u))},function(){u.invoke=i;u.instantiate=r}}function s(){o.pop()();e.pop();f--}function l(n,t){return function(r){return s(),i.$broadcast("$transitionSuccess",t),n.resolve(r),r}}function a(n,t){return function(u){return s(),i.$broadcast("$transitionError",t,u),n.reject(u),r.reject(u)}}var h=t.transitionTo,f=-1,e=[],o=[];return t.transitionTo=function(){var n=r.defer(),i=e[++f]={promise:n.promise},u;return o[f]=function(){},u=h.apply(t,arguments),u.then(l(n,i),a(n,i))},i.$on("$stateChangeStart",function(t,r,u,s,h){var l=f,a=n.extend(e[l],{to:{state:r,params:u},from:{state:s,params:h}}),v=c(a);o[l]=v;i.$broadcast("$transitionStart",a)}),t}])}]),function(){function i(t,i,r){return{scope:{width:"@",height:"@"},restrict:"AE",template:"<svg><\/svg>",link:function(i,u){function g(t){t=t.map(function(t){return t.name===""?f:n.copy(t)});n.extend(p,t.reduce(function(n,t){return n[t.name]=t,n},{}));t.forEach(function(n){var i=n.name.split(/\./).slice(0,-1).join("."),t=n.name!=i&&p[i];t&&((t.children||(t.children=[])).push(n),n.px=t.px,n.py=t.py,o.push(n))})}function k(){function r(n){var t=n.name.split(".").pop();return n.sticky&&(t+=" (STICKY)"),n.deepStateRedirect&&(t+=" (DSR)"),t}var t,n,i;a=a.data(l.nodes(f),function(n){return n.name});v=v.data(l.links(o),function(n){return n.target.name});y=y.data(e);o.forEach(function(n){n.y=n.depth*70});t=a.enter();y.enter().append("circle").attr("class","active").attr("r",13).attr("cx",function(n){return n.parent.px||100}).attr("cy",function(n){return n.parent.py||100});t.append("circle").attr("class","node").attr("r",9).attr("cx",function(n){return n.parent.px}).attr("cy",function(n){return n.parent.py});t.append("text").attr("class","label").attr("x",function(n){return n.parent.px}).attr("y",function(n){return n.parent.py}).attr("text-anchor",function(){return"middle"}).text(r).style("fill-opacity",1);v.enter().insert("path",".node").attr("class","link").attr("d",function(n){var t={x:n.source.px,y:n.source.py};return w({source:t,target:t})});n=s.transition().duration(d);n.selectAll(".link").attr("d",w);i={entered:"#AF0",exited:"#777",active:"#0f0",inactive:"#55F",future:"#009"};n.selectAll(".node").attr("cx",function(n){return n.px=n.x}).attr("cy",function(n){return n.py=n.y}).attr("r",function(n){return n.status==="active"?15:10}).style("fill",function(n){return i[n.status]||"#FFF"});n.selectAll(".label").attr("x",function(n){return n.px=n.x}).attr("y",function(n){return n.py=n.y-15}).attr("transform",function(n){return"rotate(-25 "+n.x+" "+n.y+")"});n.selectAll(".active").attr("x",function(n){return n.px=n.x}).attr("y",function(n){return n.py=n.y-15})}var p={},h=i.width||400,c=i.height||400,l=d3.layout.tree().size([h-20,c-20]).separation(function(n,t){return n.parent==t.parent?10:25}),f=t.get().filter(function(n){return n.name===""})[0],o=l(f),e;f.parent=f;f.px=f.x=h/2;f.py=f.y=c/2;e={};e.px=e.x=f.px;e.py=e.y=f.py;var w=d3.svg.diagonal(),s=d3.select(u.find("svg")[0]).attr("width",h).attr("height",c).append("g").attr("transform","translate(10, 10)"),a=s.selectAll(".node"),v=s.selectAll(".link"),y=s.selectAll(".active"),b=200,d=200,nt=setInterval(k,b);r(function(){i.states=t.get();n.forEach(o,function(n){var i=t.get(n.name);i&&(n.status=i.status||"exited")})},250);i.$watchCollection("states",function(n,t){var i=(t||[]).map(function(n){return n.name});g((n||[]).filter(function(n){return i.indexOf(n.name)==-1}))});k(b)}}}var t=n.module("ct.ui.router.extras.statevis",["ct.ui.router.extras.core","ct.ui.router.extras.sticky"]);t.directive("stateVis",["$state","$timeout","$interval",i])}();n.module("ct.ui.router.extras",["ct.ui.router.extras.core","ct.ui.router.extras.dsr","ct.ui.router.extras.future","ct.ui.router.extras.previous","ct.ui.router.extras.statevis","ct.ui.router.extras.sticky","ct.ui.router.extras.transition"])})(angular);
//# sourceMappingURL=ct-ui-router-extras.min.js.map
