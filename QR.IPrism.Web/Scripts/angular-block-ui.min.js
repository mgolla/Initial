/*!
   angular-block-ui v0.2.1
   (c) 2015 (null) McNull https://github.com/McNull/angular-block-ui
   License: MIT
*/
(function(n){function r(t){try{n.module(t)}catch(i){return!1}return!0}function u(n,t,i){if(i.blockBrowserNavigation){function u(){n.$on("$locationChangeStart",function(n){t.$_blockLocationChange&&t.state().blockCount>0&&n.preventDefault()});n.$on("$locationChangeSuccess",function(){t.$_blockLocationChange=i.blockBrowserNavigation})}if(r("ngRoute"))var f=n.$on("$viewContentLoaded",function(){f();u()});else u()}}var t=n.module("blockUI",[]),i;t.config(["$provide","$httpProvider",function(n,t){n.decorator("$exceptionHandler",["$delegate","$injector",function(n,t){var i,r;return function(u,f){if(r=r||t.get("blockUIConfig"),r.resetOnException)try{i=i||t.get("blockUI");i.instances.reset()}catch(e){console.log("$exceptionHandler",u)}n(u,f)}}]);t.interceptors.push("blockUIHttpInterceptor")}]);t.run(["$document","blockUIConfig","$templateCache",function(n,t,i){t.autoInjectBodyBlock&&n.find("body").attr("block-ui","main");t.template&&(t.templateUrl="$$block-ui-template$$",i.put(t.templateUrl,t.template))}]);t.config(["$provide",function(n){n.decorator("$location",i)}]);i=["$delegate","blockUI","blockUIConfig",function(t,i,r){if(r.blockBrowserNavigation){i.$_blockLocationChange=!0;var u=["url","path","search","hash","state"];function f(n){var r=t[n];t[n]=function(){var n=r.apply(t,arguments);return n===t&&(i.$_blockLocationChange=!1),n}}n.forEach(u,f)}return t}];t.directive("blockUiContainer",["blockUIConfig","blockUiContainerLinkFn",function(n,t){return{scope:!0,restrict:"A",templateUrl:n.templateUrl,compile:function(){return t}}}]).factory("blockUiContainerLinkFn",["blockUI","blockUIUtils",function(){return function(n,t){var i=t.inheritedData("block-ui");if(!i)throw new Error("No parent block-ui service instance located.");n.state=i.state()}}]);t.directive("blockUi",["blockUiCompileFn",function(n){return{scope:!0,restrict:"A",compile:n}}]).factory("blockUiCompileFn",["blockUiPreLinkFn",function(n){return function(t){return t.append('<div block-ui-container class="block-ui-container"><\/div>'),{pre:n}}}]).factory("blockUiPreLinkFn",["blockUI","blockUIUtils","blockUIConfig",function(n,t,i){return function(r,f,e){var s,o,h,c,l;f.hasClass("block-ui")||f.addClass(i.cssClass);e.$observe("blockUiMessageClass",function(n){r.$_blockUiMessageClass=n});s=e.blockUi||"_"+r.$id;o=n.instances.get(s);s==="main"?u(r,o,i):(h=f.inheritedData("block-ui"),h&&(o._parent=h));r.$on("$destroy",function(){o.release()});o.addRef();r.$_blockUiState=o.state();r.$watch("$_blockUiState.blocking",function(n){f.attr("aria-busy",!!n);f.toggleClass("block-ui-visible",!!n)});r.$watch("$_blockUiState.blockCount > 0",function(n){f.toggleClass("block-ui-active",!!n)});c=e.blockUiPattern;c&&(l=t.buildRegExp(c),o.pattern(l));f.data("block-ui",o)}}]);t.constant("blockUIConfig",{templateUrl:"angular-block-ui/angular-block-ui.ng.html",delay:250,message:"Loading ...",autoBlock:!0,resetOnException:!0,requestFilter:n.noop,autoInjectBodyBlock:!0,cssClass:"block-ui block-ui-anim-fade",blockBrowserNavigation:!1});t.factory("blockUIHttpInterceptor",["$q","$injector","blockUIConfig","$templateCache",function(n,t,i,r){function f(){u=u||t.get("blockUI")}function e(n){i.autoBlock&&n&&!n.$_noBlock&&n.$_blocks&&(f(),n.$_blocks.stop())}function o(t){try{e(t.config)}catch(i){console.log("httpRequestError",i)}return n.reject(t)}var u;return{request:function(n){if(i.autoBlock&&!(n.method=="GET"&&r.get(n.url))){var t=i.requestFilter(n);t===!1?n.$_noBlock=!0:(f(),n.$_blocks=u.instances.locate(n),n.$_blocks.start(t))}return n},requestError:o,response:function(n){return n&&e(n.config),n},responseError:o}}]);t.factory("blockUI",["blockUIConfig","$timeout","blockUIUtils","$document",function(t,i,r,u){function h(f){var h=this,c={id:f,blockCount:0,message:t.message,blocking:!1},l,a=[];this._id=f;this._refs=0;this.start=function(f){function a(){l=null;c.blocking=!0}f=f||{};n.isString(f)?f={message:f}:n.forEach(s,function(n){if(f[n])throw new Error("The property "+n+" is reserved for the block state.");});n.extend(c,f);c.message=c.blockCount>0?f.message||c.message||t.message:f.message||t.message;c.blockCount++;var e=n.element(u[0].activeElement);e.length&&r.isElementInBlockScope(e,h)&&(h._restoreFocus=e[0],i(function(){h._restoreFocus&&h._restoreFocus!==o[0]&&h._restoreFocus.blur()}));l||t.delay===0?t.delay===0&&a():l=i(a,t.delay)};this._cancelStartTimeout=function(){l&&(i.cancel(l),l=null)};this.stop=function(){c.blockCount=Math.max(0,--c.blockCount);c.blockCount===0&&h.reset(!0)};this.isBlocking=function(){return c.blocking};this.message=function(n){c.message=n};this.pattern=function(n){return n!==undefined&&(h._pattern=n),h._pattern};this.reset=function(t){if(h._cancelStartTimeout(),c.blockCount=0,c.blocking=!1,h._restoreFocus&&(!u[0].activeElement||u[0].activeElement===o[0])){try{h._restoreFocus.focus()}catch(r){(function(){var n=h._restoreFocus;i(function(){if(n)try{n.focus()}catch(t){}},100)})()}h._restoreFocus=null}try{t&&n.forEach(a,function(n){n()})}finally{a.length=0}};this.done=function(n){a.push(n)};this.state=function(){return c};this.addRef=function(){h._refs+=1};this.release=function(){--h._refs<=0&&e.instances._destroy(h)}}var o=u.find("body"),s=["id","blockCount","blocking"],f=[],e;return f.get=function(n){if(!isNaN(n))throw new Error("BlockUI id cannot be a number");var t=f[n];return t||(t=f[n]=new h(n),f.push(t)),t},f._destroy=function(t){if(n.isString(t)&&(t=f[t]),t){t.reset();var i=r.indexOf(f,t);f.splice(i,1);delete f[t.state().id]}},f.locate=function(n){var t=[],i,u,o;for(r.forEachFnHook(t,"start"),r.forEachFnHook(t,"stop"),i=f.length;i--;)u=f[i],o=u._pattern,o&&o.test(n.url)&&t.push(u);return t.length===0&&t.push(e),t},r.forEachFnHook(f,"reset"),e=f.get("main"),e.addRef(),e.instances=f,e}]);t.factory("blockUIUtils",function(){var i=n.element,t={buildRegExp:function(n){var t=n.match(/^\/(.*)\/([gim]*)$/),i;if(t)i=new RegExp(t[1],t[2]);else throw Error("Incorrect regular expression format: "+n);return i},forEachFn:function(n,t,i){for(var u=n.length,r;u--;)r=n[u],r[t].apply(r,i)},forEachFnHook:function(n,i){n[i]=function(){t.forEachFn(this,i,arguments)}},isElementInBlockScope:function(n,t){for(var i=n.inheritedData("block-ui");i;){if(i===t)return!0;i=i._parent}return!1},findElement:function(n,r,u){var f=null,e,o;if(r(n))f=n;else for(e=u?n.parent():n.children(),o=e.length;!f&&o--;)f=t.findElement(i(e[o]),r,u);return f},indexOf:function(n,t,i){for(var r=i||0,u=n.length;r<u;r++)if(n[r]===t)return r;return-1}};return t});n.module("blockUI").run(["$templateCache",function(n){n.put("angular-block-ui/angular-block-ui.ng.html",'<div class="block-ui-overlay"><\/div><div class="block-ui-message-container" aria-live="assertive" aria-atomic="true"><div class="block-ui-message" ng-class="$_blockUiMessageClass">{{ state.message }}<\/div><\/div>')}])})(angular);
//# sourceMappingURL=angular-block-ui.min.js.map
